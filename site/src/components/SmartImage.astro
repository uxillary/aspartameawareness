---
import fs from "node:fs";
import path from "node:path";
import { fileURLToPath } from "node:url";

const { src = "", alt = "", caption = "" } = Astro.props;

// Resolve to /public on disk
const rel = (src || "").replace(/^\/+/, "");
const publicDir = fileURLToPath(new URL("../../public/", import.meta.url));
const abs = path.join(publicDir, rel);
const exists = rel && fs.existsSync(abs);
---

{exists ? (
  <img src={src} alt={alt} loading="lazy" decoding="async" class="my-4" />
) : (
  <figure class="my-4 text-sm opacity-70">
    <figcaption>{alt || caption || "Image pending upload"}</figcaption>
  </figure>
)}
